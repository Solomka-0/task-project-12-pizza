# Pizza Service API

Проект реализует систему управления пиццерией с использованием RESTful API, построенного на PHP 8.0.

## Содержание

- [Требования](#требования)
- [Установка](#установка)
- [Обзор архитектуры](#обзор-архитектуры)
    - [Слои и абстракции](#слои-и-абстракции)
    - [Таблицы базы данных](#таблицы-базы-данных)
    - [Связи моделей](#связи-моделей)
- [Использование](#использование)

## Требования

- PHP 8.0 или выше
- MySQL 8.0 или PostgreSQL
- Composer
- Docker и Docker Compose (если используется контейнеризация)

## Установка

### Локально
1. **Клонируйте репозиторий:**
```bash
git clone git@github.com:Solomka-0/task-project-12-pizza.git
cd pizza-service-api
```
2. **Установите зависимости PHP:**
```bash 
composer install
```
3. **Настройте переменные окружения:**

   Скопируйте `.env.example` в `.env` и настройте параметры подключения к базе данных.

4. **Инициализируйте схему БД mysql, если пользуетесь mysql:**
```mysql 
CREATE DATABASE pizza;
USE pizza;

CREATE TABLE orders (
    order_id VARCHAR(15) PRIMARY KEY,
    done BOOLEAN NOT NULL
);

CREATE TABLE order_items (
    order_id VARCHAR(15),
    item_id INT NOT NULL,
    FOREIGN KEY (order_id) REFERENCES orders(order_id)
);
```
### Docker
1. **Соберите приложение с помощью Docker Compose (c предустановленным и запущенным Docker):**
```bash 
docker-compose up -d
```
## Обзор архитектуры

### Слои и абстракции

Система разделена на несколько слоев и выделены соответствующие паттерны:

1. **Контроллеры:** Обрабатывают HTTP-запросы и ответы.
2. **Запросы:** Валидация запросов.
3. **Сервисный слой:** Содержат бизнес-логику, в частности `OrderService`.
4. **Репозитории:** Абстрагируют работу с базой данных.
5. **Модели:** Представляют сущности базы данных.
7. **Маршруты:** Определяют пути API и связывают их с контроллерами.

### Таблицы базы данных

1. **orders:** Хранит информацию о заказах.
    - `order_id`
    - `done`
3. **order_items:** Хранит ингридиенты заказов.
    - `order_id`
    - `item_id`

### Связи моделей

- **Order** (один) - **OrderItem** (многие)

## Использование

1. Создание нового заказа:

   Отправьте POST запрос на /orders с данными:

```json
{
"items": [1, 2, 3, 3]
}
```
Ответ: 
```json
{
"order_id": "aac",
"items": [1, 2, 3, 3],
"done": false
}
```
2. Добавление товаров в заказ:

Отправьте POST запрос на /orders/{order_id}/items с данными:

```json
[4, 7, 8]
```
Ответ:
```1```

3. Получение информации о заказе:

Отправьте GET запрос на /orders/{order_id}.

Ответ:
```json
{
"order_id": "aac",
"items": [1, 2, 3, 3, 4, 7, 8],
"done": false
}
```
4. Пометка заказа как выполненного:

Отправьте POST запрос на /orders/{order_id}/done с заголовком авторизации:

http
X-Auth-Key: qwerty123

Ответ:

```
1
```

5. Получение списка заказов:

Отправьте GET запрос на /orders или /orders?done=1 для фильтрации по выполненным заказам. Добавьте заголовок авторизации.

http
X-Auth-Key: qwerty123

Ответ:

```json
[
    {
        "orderid": "aac",
        "done": true
    },
    ...
]
```